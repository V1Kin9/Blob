# 背景

最近调试遇到一个很有趣的问题：某ARM程序需要实现一个跳转，该跳转目标是一个绝对地址，在实现跳转的时候，直接运行会触发异常，但单步调试却可以正常执行。

## 原因分析思路

1. 首先，该跳转的函数实现是通过内嵌汇编汇编实现的，使用的是BX指令，该指令会跳转到对应的寄存器中的目标地址，同时会把该指令的下一条指令（即BX指令在本上下文中的下一条指令）写到LR寄存器中，用于返回。

2. BX指令是具有切换架构状态的能力，即可以切换架构为ARM或Thumb状态。Thumb指令是16 bit（Thumb-2是32 bit）的，而ARM指令是32 bit。

3. 在调试的过程中，看到J-Link-commander会提示架构与指令不符的提示，然后有自动修改CPSR.T的操作（把对应的bit修改为合法的值）

## 结论

通过以上现象，可以推断出，这个问题有可能是这样触发的：

1. 跳转的目标地址指令与当前的架构不一致
2. 在单步调试的过程中，J-Link-Commander对对应的寄存器作了修改，导致单步调试时可以正常运行，而全速run或直接执行时，则会触发异常
